# AI体験 📸写真→ぬりえ 変換アプリ

このプロジェクトは、Webカメラで撮影した写真を「ぬりえ」風の線画に変換するNext.jsアプリケーションです。撮影した写真は一時的にサーバーに保存され、img2img APIを通じて変換処理が行われた後、不要になった一時ファイルは削除されます。

## 主な機能

-   **Webカメラ撮影:** ブラウザから直接写真を撮影できます。
-   **画像の一時保存:** 撮影した画像はPNG形式でサーバーの `tmp` ディレクトリに一時保存されます。
-   **img2img API連携:** 保存された画像パスをimg2img API (`http://localhost:5000/api/convert`) に送信し、線画変換処理を行います。
    -   使用プロンプト: `"シンプルでかわいい、アニメ風の線画を作成して"` (固定)
-   **画像表示:** 撮影した元画像と、変換後のぬりえ画像を表示します。
-   **ローディング表示:** 画像変換中には、鉛筆が動くアニメーションが表示されます。
-   **一時ファイル管理:** 変換完了後、または「クリア」ボタン操作時に、サーバー上の一時ファイルが自動的に削除されます。
-   **UI制御:** アプリケーションの状態（通常時、撮影プレビュー時、変換中、変換完了時）に応じて、表示されるUIコンポーネントが変化します。
-   **エラーハンドリング:** API接続エラーや画像保存エラーなどが発生した場合、ユーザーにエラーメッセージを表示します。
-   **日付表示:** アプリケーションのヘッダーには、現在の「体験日」が動的に表示されます。

## 技術スタック

-   Next.js (Reactフレームワーク)
-   React
-   `react-webcam` (Webカメラアクセス用ライブラリ)
-   Node.js (Next.js API Routesでのサーバーサイド処理: ファイル保存・削除など)

## 前提条件

-   Node.js v18.x 以上 (推奨)
-   npm (Node.jsに同梱)
-   img2img APIサーバーがローカル環境の `http://localhost:5000` で稼働していること。
    -   参考: [misakiotb/img2img](https://github.com/misakiotb/img2img) などの互換APIサーバー

## セットアップと実行方法

1.  **リポジトリのクローン (必要な場合):**
    ```bash
    git clone <リポジトリURL>
    cd img2img-frontend
    ```
2.  **依存パッケージのインストール:**
    ```bash
    npm install
    ```
3.  **開発サーバーの起動:**
    ```bash
    npm run dev
    ```
4.  **ブラウザでアクセス:**
    開発サーバー起動後、ブラウザで `http://localhost:3000` を開いてください。

## APIルート (本フロントエンドプロジェクト内)

-   `POST /api/save-image`
    -   機能: Webカメラで撮影されたBase64形式の画像データを受け取り、サーバーの `tmp` ディレクトリにPNGファイルとして一時保存します。
    -   レスポンス: 保存されたファイル名とフルパスを返します。
-   `POST /api/delete-image`
    -   機能: 指定されたファイル名の画像を `tmp` ディレクトリから削除します。
    -   レスポンス: 成功または失敗のステータ스를返します。

## 連携するimg2img APIについて

-   **エンドポイント (期待値):** `http://localhost:5000/api/convert`
-   **リクエストボディ (例):
    ```json
    {
      "prompt": "シンプルでかわいい、アニメ風の線画を作成して",
      "imagePath": "tmp/1678886400000_image.png"
    }
    ```
-   **レスポンスボディ (期待する形式):
    ```json
    {
      "data": [
        {
          "b64_json": "(変換後のBase64エンコードされた画像データ)"
        }
      ]
    }
    ```

## ディレクトリ構成のポイント

-   `pages/index.js`: アプリケーションのメインUIコンポーネントとクライアントサイドロジック。
-   `pages/api/save-image.js`: 画像保存APIルート。
-   `pages/api/delete-image.js`: 画像削除APIルート。
-   `tmp/`: 画像一時保存用ディレクトリ。アプリケーション実行時に自動生成されることがあります。このディレクトリは `.gitignore` に追加することを推奨します。

## 注意点

-   `tmp/` ディレクトリは、Next.jsアプリケーションを実行するユーザーが書き込み権限を持っている必要があります。
-   img2img APIに送信するプロンプトは、現在 `pages/index.js` 内にハードコードされています。

---

ご不明な点や改善提案があれば、お気軽にお知らせください。
